<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal VIP - Extrator Sheets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .shadow-custom {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body>

    <div id="app" class="min-h-screen bg-gray-50 flex flex-col items-center">
        <header id="main-header" class="w-full bg-teal-600 shadow-md">
            <div class="max-w-4xl mx-auto flex justify-start items-center px-4 py-3">
                <h1 class="text-2xl font-bold text-white">Portal <span class="text-yellow-300">VIP</span> - Extrator Sheets</h1>
            </div>
        </header>

        <div class="w-full max-w-4xl p-4 sm:p-8">
             <p id="message-area" class="mt-2 mb-4 text-center text-sm font-medium text-gray-700" style="min-height: 1.25rem;">Pronto para convers√£o local.</p>
            
            <div id="converter-view" class="view-active">
                <div class="text-center mb-10">
                    <h1 class="text-3xl sm:text-4xl font-extrabold text-teal-600">Fluxo Gemini para Google Sheets</h1>
                    <p class="text-md sm:text-lg text-gray-600 mt-2">Gere a busca, extraia os dados com Gemini e envie direto para sua planilha.</p>
                </div>
                
                <div id="drive-config-card" class="bg-white p-6 rounded-2xl shadow-custom border-t-8 border-purple-500 mb-10">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>
                        1. Configurar Link do Google Sheets
                    </h2>
                    
                    <p class="text-sm text-gray-600 mb-4">
                        Cole o link da pasta ou da planilha modelo (template) do Google Sheets.
                    </p>
                    
                    <input
                        type="url"
                        id="driveLinkInput"
                        class="w-full p-4 border border-gray-300 rounded-lg shadow-inner focus:ring-purple-500 focus:border-purple-500 text-sm"
                        placeholder="Ex: https://docs.google.com/spreadsheets/d/SEU_TEMPLATE_ID..."
                        oninput="window.updateInputState('driveLink', this.value)"
                        required
                    />
                    
                    <button
                        id="save-drive-button"
                        onclick="window.saveDriveLink()"
                        disabled
                        class="w-full h-10 mt-4 bg-purple-600 text-white rounded-xl hover:bg-purple-700 focus:ring-4 focus:ring-purple-500/50 shadow-lg text-base transition duration-150 font-semibold disabled:bg-gray-400"
                    >
                        Salvar Link (Localmente no Navegador)
                    </button>
                    <p id="drive-status-message" class="mt-3 text-center text-sm text-gray-500" style="min-height: 1.25rem;">Link salvo ser√° carregado automaticamente.</p>
                </div>
                
                <div id="google-dork-card" class="bg-white p-6 rounded-2xl shadow-custom border-t-8 border-teal-500 mb-10">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        2. Gerador de Busca Secreta (Google Dork)
                    </h2>
                    
                    <div id="input-fields" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                        </div>
                    
                    <button id="collect-button" onclick="window.openGoogleSearch()" disabled class="w-full h-12 bg-teal-600 text-white rounded-xl hover:bg-teal-700 focus:ring-4 focus:ring-teal-500/50 shadow-lg text-lg transition duration-150 font-semibold disabled:bg-gray-400">
                        Abrir Google para Coletar Prints
                    </button>
                    <p id="dork-status-message" class="mt-3 text-center text-sm text-gray-500" style="min-height: 1.25rem;">Preencha todos os 4 campos acima.</p>
                </div>

                <div id="converter-card" class="bg-white p-6 rounded-2xl shadow-custom border-t-8 border-yellow-500 mb-10">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        3. Colar Dados do Gemini e A√ß√µes
                    </h2>
                    
                    <p class="text-sm text-gray-600 mb-4">
                        Ap√≥s finalizar a coleta no Gemini, cole o texto **completo** aqui. Os dados devem estar separados por **ponto e v√≠rgula (;)**.
                    </p>
                    
                    <textarea
                        id="rawGeminiInput"
                        class="w-full p-4 border border-gray-300 rounded-lg shadow-inner h-32 resize-none focus:ring-teal-500 focus:border-teal-500 text-sm font-mono"
                        placeholder="Cole aqui o texto acumulado do Gemini (separado por ponto e v√≠rgula)..."
                        oninput="window.updateInputState('rawGeminiInput', this.value)"
                    ></textarea>
                    
                    <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 mt-4">
                        <button
                            id="copy-text-button"
                            onclick="window.copyRawText()"
                            disabled
                            class="w-full sm:w-1/2 h-12 bg-green-600 text-white rounded-xl hover:bg-green-700 transition duration-150 disabled:bg-gray-400 font-semibold text-lg"
                        >
                            Copiar Dados para Colar (;)
                        </button>
                        <button
                            id="open-drive-button"
                            onclick="window.openDriveLink()"
                            disabled
                            class="w-full sm:w-1/2 h-12 bg-yellow-600 text-white rounded-xl hover:bg-yellow-700 transition duration-150 disabled:bg-gray-400 font-semibold text-lg"
                        >
                            Abrir Google Drive / Template
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        
        // --- VARI√ÅVEIS DE ESTADO DA APLICA√á√ÉO (LOCAL) ---
        window.state = {
            driveLink: localStorage.getItem('googleDriveLink') || '',
            cidade: '',
            estado: '',
            segmento: '',
            anoAbertura: '',
            rawGeminiInput: '',
        };

        const FIXED_SOURCE = "cnpj.biz";

        // --- FUN√á√ïES UTILIT√ÅRIAS ---

        const encodeUrl = (str) => encodeURIComponent(str).replace(/[!'()*]/g, function(c) {
            return '%' + c.charCodeAt(0).toString(16);
        });
        
        // --- FUN√á√ïES DE L√ìGICA DE NEG√ìCIO ---

        const generateFullQuery = () => {
            const s = window.state;
            const trimmedCidade = s.cidade.trim();
            if (trimmedCidade === '') return '';

            let parts = [];
            parts.push(`inurl:"${FIXED_SOURCE}"`); 

            const intextTerms = [];
            intextTerms.push(`intext:"${trimmedCidade}"`);
            if (s.estado.trim()) intextTerms.push(`intext:"${s.estado.trim()}"`);
            if (s.segmento.trim()) intextTerms.push(`intext:"${s.segmento.trim()}"`);
            if (s.anoAbertura.trim()) intextTerms.push(`intext:"${s.anoAbertura.trim()}"`);

            if (intextTerms.length > 0) {
                parts.push('(' + intextTerms.join(' AND ') + ')');
            }
            
            return parts.join(' ').trim();
        };

        window.openGoogleSearch = () => {
            const queryCode = generateFullQuery(); 
            if (!queryCode) {
                window.updateMessage('‚ö†Ô∏è Preencha a Cidade e outros campos para gerar o c√≥digo de busca.');
                return;
            }
            const encodedQuery = encodeUrl(queryCode);
            const googleUrl = `https://www.google.com/search?q=${encodedQuery}`;
            window.open(googleUrl, '_blank'); 
            window.updateMessage(`Aberto Google Search. Cole os prints no Gemini ap√≥s a busca.`);
        };

        window.saveDriveLink = () => {
            const link = window.state.driveLink.trim();
            if (!link || !link.startsWith('http')) {
                window.updateMessage('‚ö†Ô∏è Por favor, insira um link de URL v√°lido para o Google Drive/Sheets.');
                return;
            }
            localStorage.setItem('googleDriveLink', link);
            window.updateState('driveLink', link);
            window.updateMessage(`‚úÖ Link do Google Sheets salvo com sucesso!`);
        };

        window.openDriveLink = () => {
            const link = window.state.driveLink.trim();
            if (!link) {
                window.updateMessage('‚ö†Ô∏è Por favor, configure o link do Google Sheets no Passo 1.');
                return;
            }
            window.open(link, '_blank');
            window.updateMessage(`üîó Abrindo o Google Drive... Coloque o texto copiado l√°!`);
        };

        window.copyRawText = async () => {
            const rawInput = document.getElementById('rawGeminiInput').value.trim();
            if (!rawInput) {
                window.updateMessage('‚ö†Ô∏è Cole o texto da tabela gerada pelo Gemini no campo antes de copiar.');
                return;
            }

            try {
                await navigator.clipboard.writeText(rawInput); 
                window.updateMessage('‚úÖ Texto copiado para a √°rea de transfer√™ncia! Siga o tutorial para colar no Google Sheets.');
            } catch (err) {
                console.error('Erro ao copiar texto: ', err);
                window.updateMessage('‚ùå Erro ao copiar. Tente Ctrl+C.');
            }
        };
        
        // --- FUN√á√ïES DE ESTADO E UI ---

        window.updateState = (key, value) => {
            window.state[key] = value;
            window.updateUI(); 
        };

        window.updateInputState = (key, value) => {
            window.state[key] = value;
            window.updateUI(); 
        };
        
        window.updateMessage = (msg) => {
             const messageArea = document.getElementById('message-area');
             if (messageArea) {
                 const isError = msg.trim().startsWith('‚ùå');
                 const isSuccess = msg.trim().startsWith('‚úÖ');
                 messageArea.className = `mt-2 mb-4 text-center text-sm font-medium ${isError ? 'text-red-600' : isSuccess ? 'text-green-700' : 'text-gray-700'}`;
                 messageArea.textContent = msg;
             }
        };

        const InputFieldHTML = (id, label, placeholder, setterName) => `
            <div>
                <label for="${id}" class="block text-sm font-medium text-gray-700">${label}</label>
                <input 
                    type="text" 
                    id="${id}" 
                    value="${window.state[setterName]}"
                    placeholder="${placeholder}" 
                    oninput="window.updateInputState('${setterName}', this.value)"
                    class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-teal-500 focus:border-teal-500 transition"
                />
            </div>
        `;

        window.initializeUI = () => {
             const driveInputEl = document.getElementById('driveLinkInput');
             if (driveInputEl) {
                 driveInputEl.value = window.state.driveLink;
             }
             
             const inputFieldsContainer = document.getElementById('input-fields');
             if(inputFieldsContainer) {
                 inputFieldsContainer.innerHTML = `
                    ${InputFieldHTML('cidade', 'Cidade (Essencial)', 'Ex: Crici√∫ma', 'cidade')}
                    ${InputFieldHTML('estado', 'Estado (Nome Completo)', 'Ex: Santa Catarina', 'estado')}
                    ${InputFieldHTML('segmento', 'Segmento/Atividade', 'Ex: Academia', 'segmento')}
                    ${InputFieldHTML('anoAbertura', 'M√™s/Ano de Abertura (MM/AAAA)', 'Ex: 11/2025', 'anoAbertura')}
                 `;
             }
             
             const rawInputEl = document.getElementById('rawGeminiInput');
             if (rawInputEl) {
                 rawInputEl.value = window.state.rawGeminiInput;
             }

             window.updateUI(); 
        };

        window.updateUI = () => {
            const s = window.state;
            const isDriveLinkReady = !!s.driveLink.trim();
            const isInputReady = !!document.getElementById('rawGeminiInput').value.trim(); 
            const isQueryReady = s.cidade.trim() && s.estado.trim() && s.segmento.trim() && s.anoAbertura.trim();
            const anyFieldFilled = s.cidade.trim() || s.estado.trim() || s.segmento.trim() || s.anoAbertura.trim();

            // 1. Atualiza o status do Link do Drive
            const driveStatusMessage = document.getElementById('drive-status-message');
            const saveDriveButton = document.getElementById('save-drive-button');
            
            if (driveStatusMessage) {
                 if (isDriveLinkReady) {
                     driveStatusMessage.textContent = 'Link de Planilha/Pasta salvo! O bot√£o "Abrir Google Drive" est√° pronto.';
                     driveStatusMessage.className = 'mt-3 text-center text-sm font-semibold text-green-600';
                 } else {
                     driveStatusMessage.textContent = 'Insira e salve o link do Google Sheets/Drive acima.';
                     driveStatusMessage.className = 'mt-3 text-center text-sm text-gray-500';
                 }
            }
            if (saveDriveButton) {
                 saveDriveButton.disabled = !s.driveLink.trim() || s.driveLink.trim() === localStorage.getItem('googleDriveLink');
            }


            // 2. Atualiza a mensagem de status da Busca Secreta
            const dorkStatusMessage = document.getElementById('dork-status-message');
            const collectButton = document.getElementById('collect-button');
            if (dorkStatusMessage) {
                 if (isQueryReady) {
                     dorkStatusMessage.textContent = 'PRONTO! Clique em "Abrir Google para Coletar Prints".';
                     dorkStatusMessage.className = 'mt-3 text-center text-sm font-semibold text-green-600';
                 } else if (anyFieldFilled) {
                     dorkStatusMessage.textContent = 'Faltam preencher alguns campos.';
                     dorkStatusMessage.className = 'mt-3 text-center text-sm font-medium text-orange-500';
                 } else {
                     dorkStatusMessage.textContent = 'Preencha todos os 4 campos acima.';
                     dorkStatusMessage.className = 'mt-3 text-center text-sm text-gray-500';
                 }
            }
            if (collectButton) {
                collectButton.disabled = !isQueryReady;
            }


            // 3. Atualiza os bot√µes de A√ß√£o Final
            const copyTextButton = document.getElementById('copy-text-button');
            const openDriveButton = document.getElementById('open-drive-button');

            if (copyTextButton) copyTextButton.disabled = !isInputReady;
            if (openDriveButton) openDriveButton.disabled = !isDriveLinkReady;
        };

        // --- INICIALIZA√á√ÉO ---
        document.addEventListener('DOMContentLoaded', () => {
            window.initializeUI();
        });
    </script>
</body>
</html>
